<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Alex Monitor Receiver</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Cast Application Framework (CAF) -->
    <script src="https://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <style>
      html,body { margin:0; height:100%; background:#000; }
      #wrap { position:fixed; inset:0; display:grid; place-items:center; background:#000; }
      #view { width:100%; height:100%; border:0; background:#000; }
      #msg { position:absolute; left:12px; bottom:12px; color:#9aa; font:12px system-ui; }
    </style>
  </head>
  <body>
    <div id="wrap">
      <iframe id="view" allow="autoplay; fullscreen"></iframe>
      <div id="msg">Receiver väntar på screenId…</div>
    </div>

    <script>
      // Cast Receiver
      const context = cast.framework.CastReceiverContext.getInstance();
      context.setInactivityTimeout(3600); // 1h
      const NS = 'urn:x-cast:com.alex.monitor';

      const view = document.getElementById('view');
      const msgEl = document.getElementById('msg');

      // Tar emot { screenId } från sendern och laddar /display/{screenId}
      context.addCustomMessageListener(NS, (evt) => {
        const data = evt.data || {};
        if (data.screenId) {
          const base = location.origin; // samma host som din app
          view.src = `${base}/display/${data.screenId}`;
          msgEl.textContent = `Visar /display/${data.screenId}`;
        }
      });

      context.start();
    </script>
  </body>
</html>
